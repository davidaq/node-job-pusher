<!DOCTYPE html>
<html>
  <head>
    <title>Job Pusher | Topics</title>
    <%if (alert) {%>
      <script>
        alert(<%-JSON.stringify(alert)%>);
        history.replaceState({}, '', '/');
      </script>
    <%}%>
  </head>
  <body>
    <div>
      <a href="/">Root</a>
      /
      Topics
    </div>
    <hr>
    <a href="/topic-edit">Create a topic</a>
    <ul>
      <%topics.forEach(topic => {%>
        <li>
          <b style="display: inline-block; min-width: 100px;"><%=topic._id%></b>
          - [
          <a href="/topic-edit?id=<%=encodeURIComponent(topic._id)%>">Edit</a>
          |
          <a href="/jobs?topic=<%=encodeURIComponent(topic._id)%>">Jobs</a>
          |
          <a href="/?remove=<%=encodeURIComponent(topic._id)%>">Remove</a>
          ]
          <br>
          <%for (let i = 0; i < 3; i++) {%>
            ----
            P<%=i%>:
            <%if (topic.counter[i]) {%>
              <%=topic.counter[i].done || 0%>
              /
              <%=topic.counter[i].running || 0%>
              /
              <%=topic.counter[i].pending || 0%>
            <%} else {%>
              0 / 0 / 0
            <%}%>
          <%}%>
          <br>
          <br>
        </li>
      <%})%>
    </ul>
    <%if (dangling.length > 0) {%>
      <b>Dangling:</b>
      <ul>
        <%dangling.forEach(topic => {%>
          <li>
            <b style="display: inline-block; min-width: 100px;"><%=topic._id%></b>
            - [
            <a href="/topic-edit?id=<%=encodeURIComponent(topic._id)%>">Edit</a>
            |
            <a href="/jobs?topic=<%=encodeURIComponent(topic._id)%>">Jobs</a>
            |
            <a href="/?remove=<%=encodeURIComponent(topic._id)%>">Remove</a>
            ]
            <br>
            <%for (let i = 0; i < 3; i++) {%>
              ----
              P<%=i%>:
              <%if (topic.counter[i]) {%>
                <%=topic.counter[i].done || 0%>
                /
                <%=topic.counter[i].running || 0%>
                /
                <%=topic.counter[i].pending || 0%>
              <%} else {%>
                0 / 0 / 0
              <%}%>
            <%}%>
            <br>
            <br>
          </li>
        <%})%>
      </ul>
    <%}%>
  </body>
</html>